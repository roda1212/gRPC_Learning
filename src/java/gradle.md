# Gradle

https://gradle.org/

>GradleはApache AntやApache Mavenのコンセプトに基づくオープンソースビルド自動化システムであり、プロジェクト設定の宣言にはApache Mavenが利用するXML形式ではなくGroovyベース、もしくはKotlin Scriptベースのドメイン固有言語 を採用している。
（[wikipedia](https://ja.wikipedia.org/wiki/Gradle)）

## build.gradle

Ivyでいうivy.xml, Mavenでいうpom.xml。
記法はgroovy。
taskと呼ばれる処理単位を定義し、実行する。

## 使ってみる

試した時のバージョン

~~~
gradle -version

------------------------------------------------------------
Gradle 6.6.1
------------------------------------------------------------

Build time:   2020-08-25 16:29:12 UTC
Revision:     f2d1fb54a951d8b11d25748e4711bec8d128d7e3

Kotlin:       1.3.72
Groovy:       2.5.12
Ant:          Apache Ant(TM) version 1.10.8 compiled on May 10 2020
JVM:          1.8.0_241 (Oracle Corporation 25.241-b07)
OS:           Windows 10 10.0 amd64
~~~

### プロキシ設定

プロキシがある環境だと設定が必要らしい。

https://qiita.com/navekazu/items/af886fa200be8a683132#%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E8%A8%AD%E5%AE%9A

### プロジェクトの初期化

以下のコマンドを実行すると、gradleを使うプロジェクトの初期化、テンプレートの作成を行ってくれる。

~~~
c:\xxx\xxx>gradle init
~~~


#### Javaアプリケーション

以下のように指定すると、Javaアプリケーション作成用のプロジェクトを作成してくれる。
（buildスクリプトの記述言語、テストフレームワークなども対話に沿って設定してくれる。）

~~~
c:\xxx\xxx\test>gradle init --type java-application

Select build script DSL:
  1: Groovy
  2: Kotlin
Enter selection (default: Groovy) [1..2] 1

Select test framework:
  1: JUnit 4
  2: TestNG
  3: Spock
  4: JUnit Jupiter
Enter selection (default: JUnit 4) [1..4] 1

Project name (default: test):
Source package (default: test):

> Task :init
Get more help with your project: https://docs.gradle.org/6.6.1/userguide/tutorial_java_projects.html

BUILD SUCCESSFUL in 13s
2 actionable tasks: 2 executed
~~~

できるもの。
.gitがデフォルトの模様。

~~~
c:\xxx\xxx\test
│  .gitattributes
│  .gitignore
│  build.gradle
│  gradlew
│  gradlew.bat
│  settings.gradle
│  
├─.gradle
│  ├─6.6.1
│  │  │  gc.properties
│  │  │  
│  │  ├─executionHistory
│  │  │      executionHistory.bin
│  │  │      executionHistory.lock
│  │  │      
│  │  ├─fileChanges
│  │  │      last-build.bin
│  │  │      
│  │  ├─fileHashes
│  │  │      fileHashes.bin
│  │  │      fileHashes.lock
│  │  │      
│  │  └─vcsMetadata-1
│  ├─buildOutputCleanup
│  │      buildOutputCleanup.lock
│  │      cache.properties
│  │      outputFiles.bin
│  │      
│  ├─checksums
│  │      checksums.lock
│  │      
│  ├─configuration-cache
│  │      gc.properties
│  │      
│  └─vcs-1
│          gc.properties
│          
├─gradle
│  └─wrapper
│          gradle-wrapper.jar
│          gradle-wrapper.properties
│          
└─src
    ├─main
    │  ├─java
    │  │  └─test
    │  │          App.java
    │  │          
    │  └─resources
    └─test
        ├─java
        │  └─test
        │          AppTest.java
        │          
        └─resources
~~~

#### Javaライブラリ

以下だとJavaライブラリ用。

~~~
>gradle init --type java-library
~~~

できるもの。

~~~
c:\xxx\xxx\test
│  .gitattributes
│  .gitignore
│  build.gradle
│  gradlew
│  gradlew.bat
│  settings.gradle
│  
├─.gradle
│  ├─6.6.1
│  │  │  gc.properties
│  │  │  
│  │  ├─executionHistory
│  │  │      executionHistory.bin
│  │  │      executionHistory.lock
│  │  │      
│  │  ├─fileChanges
│  │  │      last-build.bin
│  │  │      
│  │  ├─fileHashes
│  │  │      fileHashes.bin
│  │  │      fileHashes.lock
│  │  │      
│  │  └─vcsMetadata-1
│  ├─buildOutputCleanup
│  │      buildOutputCleanup.lock
│  │      cache.properties
│  │      outputFiles.bin
│  │      
│  ├─checksums
│  │      checksums.lock
│  │      
│  ├─configuration-cache
│  │      gc.properties
│  │      
│  └─vcs-1
│          gc.properties
│          
├─gradle
│  └─wrapper
│          gradle-wrapper.jar
│          gradle-wrapper.properties
│          
└─src
    ├─main
    │  ├─java
    │  │  └─test
    │  │          Library.java
    │  │          
    │  └─resources
    └─test
        ├─java
        │  └─test
        │          LibraryTest.java
        │          
        └─resources
~~~

### gradle-wrapper, gradlew

ビルドには、gradleコマンドを用いることもできるが、今後はgradlew(.bat)を使用していく。

gradlewは、指定したバージョンのgradleを取得してくれた上でビルドを行ってくれる。
なので、メンバーが自力でgradleをインストールしたりせずに済み、また、メンバー間でのバージョン差異が生じなくて済む。

そのため、gradle initを実行してできた以下のものは、今後もプロジェクトで共有していく。

* gradle ディレクトリ
  * gradle-wrapper.jar : 本体 
  * gradle-wrapper.properties : URL他のプロパティが記載
* gradlew(.bat)
  * jarの実行

参考：http://gradle.monochromeroad.com/docs/userguide/gradle_wrapper.html

### build.gradleの中身

java-applicationで生成されたもの

~~~groovy
/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.6.1/userguide/tutorial_java_projects.html
 */

// 使用するプラグインを指定するブロック
plugins {
    // Apply the java plugin to add support for Java
    id 'java'

    // Apply the application plugin to add support for building a CLI application.
    id 'application'
}

// 依存を解決するためのリポジトリを指定するブロック
repositories {
    // Use jcenter for resolving dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
}

// 依存ライブラリを指定するブロック
dependencies {
    // This dependency is used by the application.
    implementation 'com.google.guava:guava:29.0-jre'

    // Use JUnit test framework
    testImplementation 'junit:junit:4.13'
}

// 生成するJavaアプリケーションの定義を指定するブロック
application {
    // Define the main class for the application.
    mainClassName = 'test.App'
}
~~~


## 参考

* https://qiita.com/hatimiti/items/a127311d739c9d3e0045
  * 割と詳しいけど、すこし古いのか？
* https://qiita.com/opengl-8080/items/a0bb31fb20cb6505188b
  * わかりやすい